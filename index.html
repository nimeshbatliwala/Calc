<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Bistro Elite Pro - Windows & Sounds</title>
    <style>
        :root {
            --safe-top: env(safe-area-inset-top, 25px);
            --safe-bottom: env(safe-area-inset-bottom, 10px);
            --bg: #000; --accent: #ff9f0a; --text: #fff; --btn: #333; --k-text: #fff; --layer1: #ff9f0a;
        }

        /* EXTENDED WINDOWS & LUXURY THEME MATRIX */
        .t-0 { --bg: #000; --btn: #1c1c1e; --accent: #ff9f0a; --text: #fff; --k-text: #fff; --layer1: #ff9f0a; } /* Apple Dark */
        .t-1 { --bg: #0078d4; --btn: #ffffff; --accent: #0078d4; --text: #fff; --k-text: #000; --layer1: #fff; } /* Win 10 Blue */
        .t-2 { --bg: #ffffff; --btn: #f3f3f3; --accent: #0078d7; --text: #000; --k-text: #000; --layer1: #0078d7; } /* Win 11 Light */
        .t-3 { --bg: #202020; --btn: #323232; --accent: #60cdff; --text: #fff; --k-text: #fff; --layer1: #60cdff; } /* Win 11 Dark */
        .t-4 { --bg: #245edb; --btn: #eeeeee; --accent: #3c8127; --text: #fff; --k-text: #000; --layer1: #fff; } /* Win XP Classic */
        .t-5 { --bg: #0a1128; --btn: #1a2a44; --accent: #00aaff; --text: #fff; --k-text: #fff; --layer1: #00aaff; } /* Azure Pro */
        .t-6 { --bg: #ff6700; --btn: #ffffff; --accent: #000; --text: #fff; --k-text: #000; --layer1: #fff; } /* Xiaomi */
        .t-7 { --bg: #000; --btn: #111; --accent: #00ff00; --text: #00ff00; --k-text: #00ff00; --layer1: #00ff00; } /* Matrix */
        .t-8 { --bg: #25d366; --btn: #fff; --accent: #075e54; --text: #fff; --k-text: #075e54; --layer1: #fff; } /* WhatsApp */
        .t-9 { --bg: #f3f3f3; --btn: #fff; --accent: #ff6700; --text: #000; --k-text: #000; --layer1: #ff6700; } /* Redmi */

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; }
        
        html, body { 
            width: 100%; height: 100%; height: -webkit-fill-available;
            overflow: hidden; position: fixed; background: var(--bg); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            color: var(--text); display: flex; flex-direction: column;
        }

        .header { height: 70px; padding-top: var(--safe-top); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .track { width: 170px; height: 36px; background: rgba(128,128,128,0.4); border-radius: 18px; position: relative; border: 1px solid rgba(255,255,255,0.2); }
        .handle { width: 65px; height: 30px; background: #ff3b30; border-radius: 15px; position: absolute; left: 3px; top: 2px; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: bold; font-size: 0.75rem; }

        .display { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; padding: 10px 30px; text-align: right; }
        #tape { font-size: 1.4rem; color: var(--layer1); min-height: 2rem; overflow-x: auto; white-space: nowrap; margin-bottom: 5px; font-weight: 500; }
        #main-val { font-size: clamp(2.5rem, 12vw, 4rem); font-weight: 700; line-height: 1.1; letter-spacing: -1px; }

        .keypad { 
            padding: 10px 20px calc(var(--safe-bottom) + 20px) 20px; 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; 
            justify-items: center; flex-shrink: 0;
        }
        .key {
            width: 72px; height: 72px; border-radius: 50%; border: none;
            background: var(--btn); color: var(--k-text);
            font-size: 1.6rem; font-weight: 600; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15); transition: transform 0.05s linear;
        }
        .key:active { transform: scale(0.9); filter: brightness(0.85); }
        .op-key { color: var(--accent) !important; }
        .eq-btn { background: var(--accent) !important; color: #fff !important; }

        /* SETTINGS SHEET */
        .sheet { position: fixed; inset: 0; background: var(--bg); z-index: 1000; transform: translateY(100%); transition: 0.4s; padding: 60px 25px; color: var(--text); overflow-y: auto; }
        .sheet.open { transform: translateY(0); }
        .card { background: rgba(128,128,128,0.2); padding: 18px; border-radius: 18px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .row { display: flex; justify-content: space-between; align-items: center; font-weight: 600; }
        
        select { background: #444; color: #fff; border: 1px solid var(--accent); padding: 10px; border-radius: 10px; font-size: 0.9rem; width: 150px; }
        #hist-box { max-height: 150px; overflow-y: auto; margin-top: 10px; font-family: monospace; }
        .hist-item { padding: 8px 0; border-bottom: 1px solid rgba(128,128,128,0.2); }
    </style>
</head>
<body class="t-0"> 

    <div class="header">
        <div class="track"><div class="handle" id="xh">EXIT</div></div>
    </div>

    <div class="display" onpointerdown="cycleTheme()">
        <div id="tape"></div>
        <div id="main-val">0</div>
    </div>

    <div class="keypad" id="pad">
        <button class="key op-key" data-val="AC">AC</button>
        <button class="key op-key" data-val="DEL">⌫</button>
        <button class="key op-key" data-val="%">%</button>
        <button class="key op-key" data-val="/">÷</button>
        <button class="key" data-val="7">7</button>
        <button class="key" data-val="8">8</button>
        <button class="key" data-val="9">9</button>
        <button class="key op-key" data-val="*">×</button>
        <button class="key" data-val="4">4</button>
        <button class="key" data-val="5">5</button>
        <button class="key" data-val="6">6</button>
        <button class="key op-key" data-val="-">−</button>
        <button class="key" data-val="1">1</button>
        <button class="key" data-val="2">2</button>
        <button class="key" data-val="3">3</button>
        <button class="key op-key" data-val="+">+</button>
        <button class="key" data-val="SET">⚙️</button>
        <button class="key" data-val="0">0</button>
        <button class="key" data-val=".">.</button>
        <button class="key eq-btn" data-val="=">=</button>
    </div>

    <div id="settings" class="sheet">
        <h2 style="margin-bottom:20px;">Settings</h2>
        <div class="card">
            <div class="row">Sound Profile
                <select id="s-prof" onchange="saveSetting('soundProf', this.value)">
                    <option value="bubble">Bubble Pop</option>
                    <option value="click">Mechanical</option>
                    <option value="piano">Grand Piano</option>
                    <option value="retro">8-Bit Game</option>
                    <option value="glass">Glass Ping</option>
                    <option value="wood">Wood Tap</option>
                    <option value="camera">Shutter</option>
                    <option value="digital">Digital Beep</option>
                    <option value="zap">Electric Zap</option>
                    <option value="none">Mute</option>
                </select>
            </div>
        </div>
        <div class="card">
            <div class="row">Answer Speaking
                <button id="v-btn" style="background:var(--accent); color:#fff; border:none; padding:10px 18px; border-radius:10px;" onpointerdown="toggleSetting('voice')">ON</button>
            </div>
        </div>
        <div class="card">
            <div class="row">Gujarati Font
                <button id="g-btn" style="background:var(--accent); color:#fff; border:none; padding:10px 18px; border-radius:10px;" onpointerdown="toggleSetting('isG')">OFF</button>
            </div>
        </div>
        <div class="card">
            <div class="row">History <span onpointerdown="clearHistory()" style="color:#ff3b30; font-size:0.8rem;">CLEAR</span></div>
            <div id="hist-box"></div>
        </div>
        <button class="key eq-btn" style="width:100%; border-radius:15px; height:60px;" onpointerdown="setOp()">CLOSE</button>
    </div>

<script>
    let currentVal = "0", equation = "", operator = null, prevVal = null, shouldReset = false;
    let history = [], tIdx = 0;
    
    let settings = {
        soundProf: localStorage.getItem('soundProf') || "bubble",
        voice: localStorage.getItem('voice') !== 'false',
        isG: localStorage.getItem('isG') === 'true'
    };

    const gMap = {'0':'૦','1':'૧','2':'૨','3':'૩','4':'૪','5':'૫','6':'૬','7':'૭','8':'૮','9':'૯'};
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function initSettings() {
        document.getElementById('s-prof').value = settings.soundProf;
        document.getElementById('v-btn').innerText = settings.voice ? "ON" : "OFF";
        document.getElementById('g-btn').innerText = settings.isG ? "ON" : "OFF";
        updateDisplay();
    }

    function saveSetting(key, val) { settings[key] = val; localStorage.setItem(key, val); }
    function toggleSetting(key) { settings[key] = !settings[key]; localStorage.setItem(key, settings[key]); initSettings(); }

    document.getElementById('pad').addEventListener('pointerdown', e => {
        const btn = e.target.closest('.key');
        if (!btn) return;
        const v = btn.dataset.val;
        if(v === 'SET') setOp(); else input(v);
    });

    function input(v) {
        playSound();
        if (v === 'AC') { currentVal = "0"; equation = ""; operator = null; prevVal = null; }
        else if (v === 'DEL') { 
            currentVal = currentVal.length > 1 ? currentVal.slice(0, -1) : "0"; 
            equation = equation.slice(0, -1);
        }
        else if (['+','-','*','/'].includes(v)) handleOp(v);
        else if (v === '=') calculate(true);
        else if (v === '%') handlePercent();
        else {
            if (shouldReset) { currentVal = v; shouldReset = false; }
            else { currentVal = currentVal === "0" ? v : currentVal + v; }
            equation += v;
        }
        updateDisplay();
    }

    function handleOp(op) {
        if (operator && !shouldReset) calculate(false);
        prevVal = currentVal; operator = op; shouldReset = true; equation += " " + op + " ";
    }

    function handlePercent() {
        let val = parseFloat(currentVal);
        currentVal = (prevVal && operator) ? (parseFloat(prevVal) * val / 100).toString() : (val / 100).toString();
        equation += "%";
    }

    function calculate(isFinal) {
        if (!operator || !prevVal) return;
        let a = parseFloat(prevVal), b = parseFloat(currentVal), res = 0;
        switch(operator) {
            case '+': res = a + b; break;
            case '-': res = a - b; break;
            case '*': res = a * b; break;
            case '/': res = a / b; break;
        }
        let final = parseFloat(res.toFixed(8)).toString();
        if (isFinal) {
            history.unshift(equation + " = " + final);
            if(history.length > 10) history.pop();
            renderHistory();
            if(settings.voice) speak(final);
            equation = final;
        }
        currentVal = final; prevVal = final; operator = isFinal ? null : operator; shouldReset = true;
    }

    function updateDisplay() {
        let dVal = settings.isG ? currentVal.toString().replace(/[0-9]/g, x => gMap[x]) : currentVal;
        let dEq = settings.isG ? equation.toString().replace(/[0-9]/g, x => gMap[x]) : equation;
        document.getElementById('main-val').innerText = dVal;
        const tape = document.getElementById('tape');
        tape.innerText = dEq; tape.scrollLeft = tape.scrollWidth;
    }

    function playSound() {
        if(settings.soundProf === 'none') return;
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator(); const g = audioCtx.createGain();
        osc.connect(g); g.connect(audioCtx.destination);
        let freq = 440, type = 'sine', dur = 0.1;
        switch(settings.soundProf) {
            case 'bubble': freq = 800; break;
            case 'click': type = 'square'; freq = 150; break;
            case 'piano': type = 'triangle'; freq = 523; dur = 0.3; break;
            case 'retro': type = 'square'; freq = 300; dur = 0.2; break;
            case 'glass': freq = 2500; dur = 0.05; break;
            case 'wood': freq = 200; dur = 0.05; break;
            case 'camera': type = 'sawtooth'; freq = 1000; dur = 0.02; break;
            case 'digital': type = 'sine'; freq = 1500; dur = 0.05; break;
            case 'zap': type = 'sawtooth'; freq = 400; dur = 0.05; break;
        }
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    function speak(t) { 
        window.speechSynthesis.cancel(); 
        let utterance = new SpeechSynthesisUtterance(t);
        utterance.rate = 1.1;
        window.speechSynthesis.speak(utterance); 
    }

    function cycleTheme() { tIdx = (tIdx + 1) % 10; document.body.className = `t-${tIdx}`; }
    function setOp() { document.getElementById('settings').classList.toggle('open'); }
    function renderHistory() { document.getElementById('hist-box').innerHTML = history.map(h => `<div class="hist-item">${h}</div>`).join(''); }
    function clearHistory() { history = []; renderHistory(); }

    let h = document.getElementById('xh'), sx, limit = 100;
    h.addEventListener('touchstart', e => { sx = e.touches[0].clientX; h.style.transition = 'none'; });
    h.addEventListener('touchmove', e => {
        let x = Math.max(0, Math.min(e.touches[0].clientX - sx, limit));
        h.style.transform = `translateX(${x}px)`;
        if(x >= limit) window.location.replace("about:blank");
    });
    h.addEventListener('touchend', () => { h.style.transition = '0.3s'; h.style.transform = 'translateX(0)'; });

    initSettings();
</script>
</body>
</html>
