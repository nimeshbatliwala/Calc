<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>V12 Platinum - Ultra Clarity</title>
    <style>
        :root { --depth: 6px; }
        
        /* THEMES TUNED FOR MAXIMUM VISIBILITY */
        body.t-0 { --car: #e60000; --accent: #ffffff; --shape: 80px 80px 120px 120px; --key: #1a1a1a; --glow: #fff; } 
        body.t-1 { --car: #000000; --accent: #00f2ff; --shape: 30px 30px 150px 150px; --key: #111111; --glow: #00f2ff; } 
        body.t-2 { --car: #f39c12; --accent: #ffdd00; --shape: 100px 30px 100px 30px; --key: #2c3e50; --glow: #ffdd00; } 
        body.t-3 { --car: #ffffff; --accent: #d00000; --shape: 60px 60px 150px 150px; --key: #222222; --glow: #ff0000; } 
        body.t-4 { --car: #2ecc71; --accent: #ffffff; --shape: 50px 50px 120px 120px; --key: #0e331d; --glow: #fff; } 
        body.t-5 { --car: #8e44ad; --accent: #00ffcc; --shape: 100px 100px 40px 40px; --key: #2e1b3b; --glow: #00ffcc; } 
        body.t-6 { --car: #ff007f; --accent: #ffffff; --shape: 70px 70px 150px 150px; --key: #3b001d; --glow: #fff; } 
        body.t-7 { --car: #2980b9; --accent: #00f2ff; --shape: 120px 120px 30px 30px; --key: #1a3e59; --glow: #00f2ff; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }
        html, body { width: 100vw; height: 100vh; overflow: hidden; background: #050505; font-family: sans-serif; display: flex; align-items: center; justify-content: center; }

        #chassis {
            width: 94%; height: 96%; position: relative; background: var(--car); border-radius: var(--shape);
            box-shadow: 0 40px 100px #000, inset 0 0 50px rgba(0,0,0,0.6); display: flex; flex-direction: column; transition: 0.5s;
        }

        .mirror { width: 34px; height: 18px; background: linear-gradient(145deg, #f0f0f0, #888, #444); position: absolute; top: 180px; z-index: 10; border: 1.5px solid #222; box-shadow: 0 4px 12px rgba(0,0,0,0.6); }
        .m-l { left: -28px; border-radius: 12px 2px 2px 12px; }
        .m-r { right: -28px; border-radius: 2px 12px 12px 2px; }

        .headlight { width: 55px; height: 22px; position: absolute; top: 12px; border-radius: 50%; background: radial-gradient(circle, #fff 10%, #add8e6 40%, transparent 80%); box-shadow: 0 0 40px 10px var(--glow); opacity: 0.95; }

        .windshield {
            margin: 45px 22px 5px; height: 32%; background: rgba(0,0,0,0.96); border-radius: 35px 35px 15px 15px;
            border: 2px solid rgba(255,255,255,0.1); padding: 5px 20px; display: flex; flex-direction: column; justify-content: space-between; text-align: right;
        }

        #layer-eq { 
            color: rgba(255,255,255,0.9); font-size: 1.6rem; font-weight: 600; 
            white-space: nowrap; overflow-x: auto; scroll-behavior: smooth; padding-top: 22px; 
        }
        #layer-eq::-webkit-scrollbar { display: none; }
        
        /* 2ND LAYER: DECREASED SIZE + NEON CLARITY */
        #layer-ans { 
            color: var(--accent); 
            font-size: 3.4rem; /* Slightly decreased */
            font-weight: 900; 
            line-height: 0.9; 
            /* Multi-layer shadow for ultimate clarity */
            text-shadow: 
                2px 2px 0px #000, 
                -1px -1px 0px #000, 
                0 0 15px var(--glow); 
            overflow: hidden; 
            padding-bottom: 2px;
            margin-bottom: -2px; 
        }

        .keypad { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 22px 30px; }
        .key {
            background: var(--key); border-radius: 18px; font-size: 1.8rem; font-weight: 800; color: #fff;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 var(--depth) 0 #000; position: relative; transition: 0.05s; border: 1px solid rgba(255,255,255,0.05);
        }
        .key:active { transform: translateY(4px); box-shadow: 0 2px 0 #000; filter: brightness(1.4); }
        .k-ac { color: #ff4d4d !important; }
        .k-eq { background: var(--accent) !important; color: #000 !important; }

        .panel { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 2000; transform: translateY(100%); transition: 0.4s; padding: 50px 25px; color: #fff; overflow-y: auto; }
        .panel.open { transform: translateY(0); }
        .row { background: #111; padding: 18px; border-radius: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        select { background: #222; color: #fff; border: none; padding: 10px; border-radius: 8px; width: 170px; font-weight: bold; }
        .sw { width: 50px; height: 26px; background: #333; border-radius: 20px; position: relative; }
        .sw.on { background: #2ecc71; }
        .sw::after { content:''; position:absolute; width:22px; height:22px; background:#fff; border-radius:50%; top:2px; left:2px; transition: 0.2s; }
        .sw.on::after { transform: translateX(24px); }
    </style>
</head>
<body class="t-0">

<div id="chassis">
    <div class="mirror m-l"></div><div class="mirror m-r"></div>
    <div class="headlight" style="left:40px;"></div><div class="headlight" style="right:40px;"></div>

    <div class="windshield" onclick="cycleTheme()">
        <div id="layer-eq">0</div>
        <div id="layer-ans">0</div>
    </div>
    
    <div class="keypad" id="pad">
        <button class="key k-ac" data-val="AC">AC</button>
        <button class="key" data-val="DEL">⌫</button>
        <button class="key" data-val="%">%</button>
        <button class="key" data-val="/" style="color:var(--accent)">÷</button>
        <button class="key" data-val="7">7</button>
        <button class="key" data-val="8">8</button>
        <button class="key" data-val="9">9</button>
        <button class="key" data-val="*" style="color:var(--accent)">×</button>
        <button class="key" data-val="4">4</button>
        <button class="key" data-val="5">5</button>
        <button class="key" data-val="6">6</button>
        <button class="key" data-val="-" style="color:var(--accent)">−</button>
        <button class="key" data-val="1">1</button>
        <button class="key" data-val="2">2</button>
        <button class="key" data-val="3">3</button>
        <button class="key" data-val="+" style="color:var(--accent)">+</button>
        <button class="key" data-val="SET">⚙️</button>
        <button class="key" data-val="0">0</button>
        <button class="key" data-val=".">.</button>
        <button class="key k-eq" data-val="=">=</button>
    </div>
</div>

<div id="settings" class="panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
        <h2>V12 GARAGE</h2>
        <button style="background:#ff4d4d; color:#fff; border:none; padding:8px 15px; border-radius:10px;" onclick="clearHist()">RESET DATA</button>
    </div>
    <div class="row">Sound Beep <select id="b-sel" onchange="save('beepProf', this.value)"></select></div>
    <div class="row">Piano Profile <select id="p-sel" onchange="save('pianoProf', this.value)"></select></div>
    <div class="row">Voice Engine <div id="v-sw" class="sw" onclick="toggle('isSpeak')"></div></div>
    <div class="row">Gujarati Digits <div id="g-sw" class="sw" onclick="toggle('isG')"></div></div>
    <div id="history" style="margin-top:20px; color:#777;"></div>
    <button class="key k-eq" style="width:100%; height:70px; margin-top:30px;" onclick="toggleSet()">DRIVE</button>
</div>

<script>
    let equation = "", currentInput = "0", isResultShown = false;
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    let settings = {
        beepProf: localStorage.getItem('beepProf') || "b1",
        pianoProf: localStorage.getItem('pianoProf') || "none",
        isG: localStorage.getItem('isG') === 'true',
        isSpeak: localStorage.getItem('isSpeak') !== 'false',
        themeIdx: parseInt(localStorage.getItem('themeIdx')) || 0
    };

    const gMap = {'0':'૦','1':'૧','2':'૨','3':'૩','4':'૪','5':'૫','6':'૬','7':'૭','8':'૮','9':'૯','+':'+','-':'-','*':'×','/':'÷','=':'=','.':'.'};
    const freq = { 'AC':261,'DEL':293,'%':329,'/':349,'7':392,'8':440,'9':493,'*':523,'4':587,'5':659,'6':698,'-':783,'1':880,'2':987,'3':1046,'+':1174,'0':1396,'.':1567,'=':1760 };

    const beeps = ["Soft Tap", "Silk Touch", "Digital", "Pulse", "Bubble", "Feather", "Glass", "Echo"];
    const pianos = ["Grand Piano", "Studio One", "Mellow Gold", "Honky Tonk", "Electric Sky", "Classic 88", "Toy Box", "Bright Key", "Dark Night", "Dream State", "Space Echo", "Jazz Club", "Crystal Bell", "Soft Wool", "Cinematic"];

    function save(k, v) { settings[k] = v; localStorage.setItem(k, v); }
    function toggle(k) { settings[k] = !settings[k]; save(k, settings[k]); initUI(); }
    function cycleTheme() { settings.themeIdx = (settings.themeIdx + 1) % 8; save('themeIdx', settings.themeIdx); initUI(); }
    function toggleSet() { document.getElementById('settings').classList.toggle('open'); }
    function clearHist() { localStorage.removeItem('calcHistory'); loadHistory(); }

    function initUI() {
        document.body.className = `t-${settings.themeIdx}`;
        document.getElementById('v-sw').className = `sw ${settings.isSpeak ? 'on' : ''}`;
        document.getElementById('g-sw').className = `sw ${settings.isG ? 'on' : ''}`;
        const b = document.getElementById('b-sel');
        b.innerHTML = '<option value="none">Mute</option>' + beeps.map((n, i) => `<option value="b${i+1}">${n}</option>`).join('');
        b.value = settings.beepProf;
        const p = document.getElementById('p-sel');
        p.innerHTML = '<option value="none">None</option>' + pianos.map((n, i) => `<option value="p${i+1}">${n}</option>`).join('');
        p.value = settings.pianoProf;
        loadHistory(); updateDisplay();
    }

    document.getElementById('pad').addEventListener('touchstart', e => {
        const b = e.target.closest('button');
        if(b) { e.preventDefault(); handleKey(b.dataset.val); }
    });

    function handleKey(v) {
        playTone(v);
        if(v === 'SET') return toggleSet();
        if(v === 'AC') { equation = ""; currentInput = "0"; isResultShown = false; speak("Clear"); }
        else if(v === 'DEL') { 
            if(isResultShown) { equation = ""; isResultShown = false; }
            else if(currentInput.length > 1) currentInput = currentInput.slice(0,-1);
            else currentInput = "0";
            speak("Back");
        }
        else if(['+','-','*','/'].includes(v)) {
            if(isResultShown) { equation = currentInput + " " + v + " "; isResultShown = false; }
            else { equation += (currentInput !== "0" ? currentInput : "0") + " " + v + " "; }
            currentInput = "0"; speak(v);
        }
        else if(v === '%') {
            if(equation) {
                let parts = equation.trim().split(" ");
                let base = parseFloat(calculate(parts.slice(0,-1).join(" ")));
                let percentVal = (base * parseFloat(currentInput)) / 100;
                currentInput = percentVal.toString();
            } else {
                currentInput = (parseFloat(currentInput) / 100).toString();
            }
        }
        else if(v === '=') {
            let res = calculate(equation + currentInput);
            addHistory(equation + currentInput + " = " + res);
            currentInput = res; equation = ""; isResultShown = true; speak(res);
        }
        else {
            if(isResultShown) { currentInput = v; equation = ""; isResultShown = false; }
            else currentInput = (currentInput === "0") ? v : currentInput + v;
            speak(v);
        }
        updateDisplay();
    }

    function calculate(s) {
        try { 
            let clean = s.replace(/×/g, '*').replace(/÷/g, '/');
            if(!clean || /[\+\-\*\/]$/.test(clean.trim())) clean = clean.trim().slice(0,-1);
            let res = eval(clean || "0");
            return Number(res.toFixed(8)).toString(); 
        } catch { return "0"; }
    }

    function updateDisplay() {
        const toG = (s) => settings.isG ? s.toString().replace(/[0-9]/g, x => gMap[x]) : s;
        let l1 = equation + (currentInput === "0" && equation !== "" && !isResultShown ? "" : currentInput);
        let l2 = isResultShown ? currentInput : calculate(equation + currentInput);
        const el1 = document.getElementById('layer-eq');
        el1.innerText = toG(l1 || "0");
        document.getElementById('layer-ans').innerText = toG(l2 || "0");
        el1.scrollLeft = el1.scrollWidth;
    }

    function playTone(v) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const now = audioCtx.currentTime;
        if(settings.beepProf !== 'none') {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.setValueAtTime(880, now); g.gain.setValueAtTime(0.04, now);
            g.gain.exponentialRampToValueAtTime(0.001, now + 0.1); o.start(); o.stop(now + 0.1);
        }
        if(settings.pianoProf !== 'none' && freq[v]) {
            const op = audioCtx.createOscillator(); const gp = audioCtx.createGain();
            op.connect(gp); gp.connect(audioCtx.destination); op.type = 'triangle';
            op.frequency.setValueAtTime(freq[v], now); gp.gain.setValueAtTime(0.12, now);
            gp.gain.exponentialRampToValueAtTime(0.001, now + 1.2); op.start(); op.stop(now + 1.2);
        }
    }

    function speak(t) {
        if(!settings.isSpeak) return;
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(t);
        u.lang = settings.isG ? 'gu-IN' : 'en-IN';
        u.rate = 2.4; window.speechSynthesis.speak(u);
    }

    function addHistory(i) {
        let h = JSON.parse(localStorage.getItem('calcHistory') || "[]");
        h.unshift(i); if(h.length > 5) h.pop();
        localStorage.setItem('calcHistory', JSON.stringify(h)); loadHistory();
    }
    function loadHistory() {
        let h = JSON.parse(localStorage.getItem('calcHistory') || "[]");
        document.getElementById('history').innerHTML = h.map(x => `<div>${x}</div>`).join('');
    }
    initUI();
</script>
</body>
</html>
