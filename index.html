<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Bistro Elite Pro - Perfect Circles</title>
    <style>
        :root {
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --bg: #0d1b4d; 
            --accent: #ffcc00;
            --text: #ffffff;
            --btn-grad: linear-gradient(145deg, #e63946, #8b0000);
            --glow: rgba(255, 60, 45, 0.6);
            --gap: 15px; /* Slightly wider gap for round buttons */
        }

        /* THEME MATRIX */
        .t-0 { --bg: #0d1b4d; --btn-grad: linear-gradient(145deg, #e63946, #8b0000); --glow: #ff4d4d; --accent: #ffcc00; --text: #fff; }
        .t-1 { --bg: #ffffff; --btn-grad: linear-gradient(145deg, #f0f0f0, #d1d1d1); --glow: #007aff; --accent: #007aff; --text: #000; }
        .t-2 { --bg: #000000; --btn-grad: linear-gradient(145deg, #1a1a1a, #0b0b0b); --glow: #39ff14; --accent: #39ff14; --text: #fff; }
        .t-3 { --bg: #1a0033; --btn-grad: linear-gradient(145deg, #5a189a, #3c096c); --glow: #f012be; --accent: #00fff2; --text: #fff; }
        .t-4 { --bg: #081c15; --btn-grad: linear-gradient(145deg, #1b4332, #081c15); --glow: #ffcc00; --accent: #ffcc00; --text: #fff; }
        .t-5 { --bg: #2d0a0a; --btn-grad: linear-gradient(145deg, #660708, #a4161a); --glow: #ff4d4d; --accent: #f5f3f4; --text: #fff; }
        .t-6 { --bg: #14213d; --btn-grad: linear-gradient(145deg, #fca311, #e85d04); --glow: #fca311; --accent: #fff; --text: #fff; }
        .t-7 { --bg: #22223b; --btn-grad: linear-gradient(145deg, #4a4e69, #22223b); --glow: #9a8c98; --accent: #c9ada7; --text: #fff; }
        .t-8 { --bg: #003049; --btn-grad: linear-gradient(145deg, #d62828, #ae2012); --glow: #f77f00; --accent: #fcbf49; --text: #fff; }
        .t-9 { --bg: #000814; --btn-grad: linear-gradient(145deg, #001d3d, #003566); --glow: #ffc300; --accent: #ffc300; --text: #fff; }

        /* SHAPES MATRIX */
        .s-0 .key { clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%); } 
        .s-1 .key { border-radius: 40% 10% 40% 10%; } 
        .s-2 .key { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); } 
        .s-3 .key { border-radius: 50%; aspect-ratio: 1 / 1; } /* PERFECT CIRCLE */
        .s-4 .key { border-radius: 15px; } /* SQUIRCLE */

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: manipulation; }
        
        html, body { 
            width: 100%; height: 100svh; overflow: hidden; position: fixed;
            background: var(--bg); transition: background 0.4s ease;
        }

        body { 
            display: flex; flex-direction: column;
            font-family: -apple-system, sans-serif;
            color: var(--text);
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }

        #wake { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        .header { height: 50px; display: flex; align-items: center; justify-content: center; }
        .track { width: 200px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 20px; position: relative; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .handle { width: 80px; height: 34px; background: #ff3b30; border-radius: 17px; position: absolute; left: 3px; top: 3px; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 900; box-shadow: 0 4px 15px rgba(255,0,0,0.3); }

        .display { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; padding: 5px 25px; text-align: right; pointer-events: auto; }
        #tape { font-size: 1.4rem; color: var(--accent); opacity: 0.8; min-height: 2rem; overflow-x: auto; white-space: nowrap; margin-bottom: 2px; scroll-behavior: smooth; }
        #tape::-webkit-scrollbar { display: none; }
        #main-val { font-size: clamp(2.5rem, 12vw, 5rem); font-weight: 700; letter-spacing: -2px; line-height: 1; }

        .keypad {
            padding: var(--gap);
            display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--gap);
            margin-bottom: calc(10px + var(--safe-bottom));
            justify-items: center; /* Center circles in grid */
        }

        .key {
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            max-height: 85px;
            max-width: 85px;
            border: none;
            background: var(--btn-grad); color: var(--text);
            font-size: 1.6rem; font-weight: 800; position: relative;
            box-shadow: 0 5px 0 rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.04s linear;
        }

        .key:active { 
            transform: translateY(3px); 
            box-shadow: 0 2px 0 rgba(0,0,0,0.4), 0 0 20px var(--glow);
            filter: brightness(1.2);
        }

        .key::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 50%);
            border-radius: inherit; pointer-events: none;
        }

        .eq-btn { background: var(--accent) !important; color: #000 !important; clip-path: none !important; }

        .sheet { position: fixed; inset: 0; background: var(--bg); z-index: 1000; transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 50px 25px; overflow-y: auto; }
        .sheet.open { transform: translateY(0); }
        .card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }

        #history-list { margin-top: 10px; max-height: 180px; overflow-y: auto; width: 100%; }
        .hist-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-family: monospace; }
        .hist-expr { color: var(--accent); font-size: 0.8rem; }
        .hist-res { font-size: 1.1rem; font-weight: bold; }

        select { background: #000; color: var(--accent); border: 1px solid var(--accent); padding: 8px; border-radius: 8px; font-weight: bold; font-size: 1rem; }
    </style>
</head>
<body class="t-0 s-3"> <div id="wake" onpointerdown="init()">
        <div style="font-size: 5rem; filter: drop-shadow(0 0 15px var(--glow));">üéπ</div>
        <h2 style="color:white; margin-top:20px; letter-spacing:6px; font-weight:200;">BISTRO ELITE</h2>
    </div>

    <div class="header">
        <div class="track"><div class="handle" id="xh">EXIT</div></div>
    </div>

    <div class="display" onpointerdown="cycleTheme()">
        <div id="tape"></div>
        <div id="main-val">0</div>
    </div>

    <div class="keypad">
        <button class="key" onpointerdown="input('AC')">AC</button>
        <button class="key" onpointerdown="input('DEL')">‚å´</button>
        <button class="key" onpointerdown="input('%')">%</button>
        <button class="key" onpointerdown="input('/')">√∑</button>

        <button class="key" onpointerdown="input('7')">7</button>
        <button class="key" onpointerdown="input('8')">8</button>
        <button class="key" onpointerdown="input('9')">9</button>
        <button class="key" onpointerdown="input('*')">√ó</button>

        <button class="key" onpointerdown="input('4')">4</button>
        <button class="key" onpointerdown="input('5')">5</button>
        <button class="key" onpointerdown="input('6')">6</button>
        <button class="key" onpointerdown="input('-')">‚àí</button>

        <button class="key" onpointerdown="input('1')">1</button>
        <button class="key" onpointerdown="input('2')">2</button>
        <button class="key" onpointerdown="input('3')">3</button>
        <button class="key" onpointerdown="input('+')">+</button>

        <button class="key" onpointerdown="setOp()">‚öôÔ∏è</button>
        <button class="key" onpointerdown="input('0')">0</button>
        <button class="key" onpointerdown="input('.')">.</button>
        <button class="key eq-btn" onpointerdown="input('=')">=</button>
    </div>

    <div id="settings" class="sheet">
        <h1 style="color:var(--accent); margin-bottom: 30px;">Configuration</h1>
        
        <div class="card">
            <span style="font-weight: 800;">Sound Profile</span>
            <select id="sound-type" onchange="changeSound(this.value)">
                <option value="samsung">Samsung Style</option>
                <option value="piano">Piano (Original)</option>
                <option value="modern">Modern Pop</option>
                <option value="digital">Digital Beep</option>
            </select>
        </div>

        <div class="card" onpointerdown="toggleG()">
            <span style="font-weight: 800;">Gujarati Numbers</span>
            <span id="g-stat" style="color:var(--accent)">OFF</span>
        </div>

        <div class="card" style="flex-direction: column; align-items: flex-start;">
            <label style="margin-bottom:12px;">Volume</label>
            <input type="range" id="vol" min="0" max="1" step="0.1" value="0.4" oninput="saveVol(this.value)" style="width: 100%; accent-color: var(--accent);">
        </div>

        <div class="card" style="flex-direction: column; align-items: flex-start;">
            <div style="display:flex; justify-content: space-between; width:100%; align-items:center;">
                <span style="font-weight: 800;">History</span>
                <span onpointerdown="clearHistory()" style="font-size:0.8rem; color: #ff3b30; font-weight:bold;">CLEAR</span>
            </div>
            <div id="history-list"></div>
        </div>

        <button class="key eq-btn" style="width:100%; height:60px; border-radius:20px; margin-top: 10px;" onpointerdown="setOp()">CLOSE</button>
    </div>

<script>
    let expr = "", isG = false, tIdx = 30, audio, currentVol = 0.4, history = [], soundType = "samsung";
    const gMap = {'0':'‡´¶','1':'‡´ß','2':'‡´®','3':'‡´©','4':'‡´™','5':'‡´´','6':'‡´¨','7':'‡´≠','8':'‡´Æ','9':'‡´Ø'};
    const notes = {'1':261,'2':293,'3':329,'4':349,'5':392,'6':440,'7':493,'8':523,'9':587,'0':659,'+':311,'-':370,'*':415,'/':466,'=':783,'%':220};

    window.onload = () => {
        tIdx = parseInt(localStorage.getItem('b_idx_50')) || 30;
        isG = localStorage.getItem('isG') === 'true';
        soundType = localStorage.getItem('b_sound_type') || "samsung";
        document.getElementById('sound-type').value = soundType;
        
        const savedVol = localStorage.getItem('b_vol_persistent');
        if (savedVol !== null) {
            currentVol = parseFloat(savedVol);
            document.getElementById('vol').value = currentVol;
        }

        const savedHist = localStorage.getItem('b_history');
        if (savedHist) {
            history = JSON.parse(savedHist);
            renderHistory();
        }
        applyL();
    };

    function init() {
        document.getElementById('wake').style.display = 'none';
        audio = new (window.AudioContext || window.webkitAudioContext)();
        if (audio.state === 'suspended') audio.resume();
    }

    function saveVol(v) {
        currentVol = parseFloat(v);
        localStorage.setItem('b_vol_persistent', v);
    }

    function changeSound(v) {
        soundType = v;
        localStorage.setItem('b_sound_type', v);
        play(440);
    }

    function input(v) {
        play(notes[v] || 440);
        if(v === 'AC') expr = "";
        else if(v === 'DEL') expr = expr.slice(0, -1);
        else if(v === '=') calculate();
        else if(v === '%') applyPercentage();
        else {
            if(/[+\-*/√ó√∑‚àí]$/.test(expr) && /[+\-*/√ó√∑‚àí]/.test(v)) expr = expr.slice(0,-1);
            expr += v;
        }
        updateDisplay();
    }

    function applyPercentage() {
        if (!expr || expr === "Error") return;
        let parts = expr.split(/([+\-*/√ó√∑‚àí])/);
        if (parts.length < 3) {
            expr = (parseFloat(expr) / 100).toString();
            return;
        }
        let lastNum = parseFloat(parts.pop());
        let operator = parts.pop();
        let baseExpr = parts.join('').replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/‚àí/g,'-');
        try {
            let baseValue = eval(baseExpr);
            let pVal = (operator === '+' || operator === '‚àí' || operator === '-') ? (baseValue * lastNum) / 100 : lastNum / 100;
            expr = parts.join('') + operator + pVal;
        } catch(e) { expr = "Error"; }
    }

    function calculate() {
        if(!expr) return;
        try { 
            let p = expr.replace(/[+\-*/√ó√∑‚àí]$/, ""); 
            let res = eval(p.replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/‚àí/g,'-'));
            let finalRes = Number.isInteger(res) ? res.toString() : parseFloat(res.toFixed(8)).toString();
            
            if (expr !== finalRes) {
                history.unshift({ e: expr, r: finalRes });
                if (history.length > 20) history.pop();
                localStorage.setItem('b_history', JSON.stringify(history));
                renderHistory();
            }
            expr = finalRes;
        } catch(e){ expr = "Error"; }
    }

    function renderHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = history.map(item => `
            <div class="hist-item">
                <div class="hist-expr">${item.e} =</div>
                <div class="hist-res">${item.r}</div>
            </div>
        `).join('');
    }

    function clearHistory() {
        history = [];
        localStorage.removeItem('b_history');
        renderHistory();
    }

    function updateDisplay() {
        let e = expr || "0", r = "0";
        try { 
            let p = expr.replace(/[+\-*/√ó√∑‚àí]$/, "");
            if(p) {
                let res = eval(p.replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/‚àí/g,'-'));
                r = Number.isInteger(res) ? res : parseFloat(res.toFixed(8));
            }
        } catch(ex) {}
        if(isG) {
            e = e.toString().replace(/[0-9]/g, x => gMap[x]);
            r = r.toString().replace(/[0-9]/g, x => gMap[x]);
        }
        const t = document.getElementById('tape');
        t.innerText = e;
        t.scrollLeft = t.scrollWidth;
        document.getElementById('main-val').innerText = r;
        document.getElementById('g-stat').innerText = isG ? "ON" : "OFF";
    }

    function cycleTheme() {
        tIdx = (tIdx + 1) % 50;
        localStorage.setItem('b_idx_50', tIdx);
        applyL();
    }

    function applyL() {
        document.body.className = `t-${tIdx % 10} s-${Math.floor(tIdx/10) % 5}`;
    }

    function toggleG() { isG = !isG; localStorage.setItem('isG', isG); updateDisplay(); }
    function setOp() { document.getElementById('settings').classList.toggle('open'); }

    function play(f) {
        if(!audio) return;
        const g = audio.createGain();
        g.connect(audio.destination);
        g.gain.setValueAtTime(currentVol, audio.currentTime);

        if (soundType === 'piano') {
            const o1 = audio.createOscillator(), o2 = audio.createOscillator();
            o1.type = 'triangle'; o2.type = 'sine';
            o1.frequency.setValueAtTime(f, audio.currentTime);
            o2.frequency.setValueAtTime(f * 2, audio.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.6);
            o1.connect(g); o2.connect(g);
            o1.start(); o2.start();
            o1.stop(audio.currentTime + 0.6); o2.stop(audio.currentTime + 0.6);
        } 
        else if (soundType === 'samsung') {
            const o1 = audio.createOscillator();
            const o2 = audio.createOscillator();
            o1.type = 'sine'; o2.type = 'sine';
            o1.frequency.setValueAtTime(140, audio.currentTime);
            o1.frequency.exponentialRampToValueAtTime(40, audio.currentTime + 0.08);
            o2.frequency.setValueAtTime(800, audio.currentTime);
            o2.frequency.exponentialRampToValueAtTime(200, audio.currentTime + 0.03);
            const g2 = audio.createGain();
            g2.gain.setValueAtTime(currentVol * 0.3, audio.currentTime);
            g2.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.03);
            g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.08);
            o1.connect(g); o2.connect(g2); g2.connect(audio.destination);
            o1.start(); o2.start(); o1.stop(audio.currentTime + 0.08); o2.stop(audio.currentTime + 0.08);
        }
        else if (soundType === 'modern') {
            const o = audio.createOscillator();
            o.type = 'sine';
            o.frequency.setValueAtTime(900, audio.currentTime);
            g.gain.setValueAtTime(currentVol * 0.5, audio.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.04);
            o.connect(g); o.start(); o.stop(audio.currentTime + 0.04);
        }
        else if (soundType === 'digital') {
            const o = audio.createOscillator();
            o.type = 'square';
            o.frequency.setValueAtTime(1200, audio.currentTime);
            g.gain.setValueAtTime(currentVol * 0.2, audio.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audio.currentTime + 0.08);
            o.connect(g); o.start(); o.stop(audio.currentTime + 0.08);
        }
    }

    let h = document.getElementById('xh'), sx, limit = 117;
    h.ontouchstart = e => { sx = e.touches[0].clientX; h.style.transition = 'none'; }
    h.ontouchmove = e => {
        let x = Math.max(0, Math.min(e.touches[0].clientX - sx, limit));
        h.style.transform = `translateX(${x}px)`;
        if(x >= limit) window.location.replace("about:blank");
    }
    h.ontouchend = () => { h.style.transition = '0.3s'; h.style.transform = 'translateX(0)'; }
</script>
</body>
</html>
