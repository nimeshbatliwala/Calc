<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Jaguar V12 - Light Garage</title>
    <style>
        :root { --bg: #000; --panel: #111; --screen: #00ff41; --scr-txt: #000; --btn: #1a1a1a; --btn-txt: #fff; --rad: 20px; --accent: #00ff41; }

        body.t-0 { --bg: #000; --panel: #0a0a0a; --screen: #00ff41; --scr-txt: #000; --btn: #1a1a1a; --btn-txt: #00ff41; --rad: 0px; --accent: #00ff41; }
        body.t-1 { --bg: #220000; --panel: #440000; --screen: #ff4500; --scr-txt: #fff; --btn: #660000; --btn-txt: #ffeb3b; --rad: 40px 0; --accent: #ffeb3b; }
        body.t-2 { --bg: #1a0033; --panel: #330066; --screen: #bf00ff; --scr-txt: #fff; --btn: #4d0099; --btn-txt: #00e5ff; --rad: 30px; --accent: #00e5ff; }
        body.t-3 { --bg: #064e3b; --panel: #065f46; --screen: #34d399; --scr-txt: #064e3b; --btn: #064e3b; --btn-txt: #fff; --rad: 15px; --accent: #34d399; }
        body.t-4 { --bg: #000; --panel: #111; --screen: #ffffff; --scr-txt: #000; --btn: #222; --btn-txt: #fff; --rad: 25px; --accent: #fff; }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100%; height: 100dvh; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; position: fixed; }

        #startup { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        #start-btn { padding: 25px 50px; border: 4px solid var(--accent, #00ff41); color: var(--accent, #00ff41); background: transparent; font-size: 1.5rem; font-weight: 900; border-radius: 50px; cursor: pointer; }

        #container { width: 100%; height: 100dvh; display: flex; flex-direction: column; background: var(--panel); opacity: 0; transition: 1s; }
        #garage-trigger { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); padding: 5px 25px; background: rgba(0,0,0,0.7); border: 1px solid var(--accent); border-radius: 20px; color: var(--accent); font-size: 13px; letter-spacing: 3px; z-index: 200; cursor: pointer; font-weight: 900; }

        #screen-area { padding-top: 50px; height: 32%; background: var(--screen); padding: 20px; display: flex; flex-direction: column; justify-content: flex-end; text-align: right; box-shadow: inset 0 0 50px rgba(0,0,0,0.6); }
        #eq-display { color: var(--scr-txt); font-size: 1.4rem; opacity: 0.8; margin-bottom: 5px; font-family: monospace; overflow-x: auto; white-space: nowrap; scrollbar-width: none; text-align: right; width: 100%; }
        #eq-display::-webkit-scrollbar { display: none; }
        #ans-display { color: var(--scr-txt); font-size: 3.5rem; font-weight: 900; line-height: 1; letter-spacing: -2px; }

        #pad { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 6px; background: #000; padding-bottom: env(safe-area-inset-bottom); }
        .btn { background: var(--btn); border: 2px solid var(--accent); border-radius: var(--rad); color: var(--btn-txt); font-size: 1.8rem; font-weight: 900; display: flex; align-items: center; justify-content: center; box-shadow: 4px 4px 0px var(--accent); }
        .btn:active { transform: translate(3px, 3px); box-shadow: 0 0 0; }
        .eq { background: var(--accent) !important; color: var(--bg) !important; }

        /* LIGHT GARAGE MENU STYLING */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .modal { width: 94%; max-height: 90vh; background: #f8f9fa; border-radius: 30px; padding: 20px; display: flex; flex-direction: column; border: 1px solid #ddd; color: #222; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .row { background: #fff; padding: 12px; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; font-weight: 900; font-size: 13px; border: 1px solid #eee; color: #444; }
        select, .tog, input[type="range"] { background: #e9ecef; color: #000; border: 1px solid #ccc; padding: 6px; border-radius: 8px; font-weight: 900; width: 140px; }
        #hist { flex: 1; overflow-y: auto; background: #fff; border-radius: 12px; padding: 12px; margin-top: 10px; font-family: monospace; font-size: 12px; border: 1px solid #eee; color: #333; }
        .clr-btn { background: #ff4444; color: #fff; border: none; padding: 5px 12px; border-radius: 5px; font-size: 11px; font-weight: 900; }
        .close-btn { width: 100%; padding: 15px; background: #222; color: #fff; border-radius: 15px; margin-top: 10px; font-weight: 900; border: none; }
    </style>
</head>
<body class="t-0">

<div id="startup"><button id="start-btn" onclick="ignite()">START ENGINE</button></div>

<div id="container">
    <div id="garage-trigger" onclick="openGarage()">GARAGE</div>
    <div id="screen-area" onclick="nextTheme()">
        <div id="eq-display">0</div>
        <div id="ans-display">0</div>
    </div>
    <div id="pad">
        <button class="btn" data-v="AC">AC</button><button class="btn" data-v="DEL">⌫</button><button class="btn" data-v="%">%</button><button class="btn" data-v="/">÷</button>
        <button class="btn digit" data-en="7" data-gu="૭" data-v="7">7</button><button class="btn digit" data-en="8" data-gu="૮" data-v="8">8</button><button class="btn digit" data-en="9" data-gu="૯" data-v="9">9</button><button class="btn" data-v="*">×</button>
        <button class="btn digit" data-en="4" data-gu="૪" data-v="4">4</button><button class="btn digit" data-en="5" data-gu="૫" data-v="5">5</button><button class="btn digit" data-en="6" data-gu="૬" data-v="6">6</button><button class="btn" data-v="-">−</button>
        <button class="btn digit" data-en="1" data-gu="૧" data-v="1">1</button><button class="btn digit" data-en="2" data-gu="૨" data-v="2">2</button><button class="btn digit" data-en="3" data-gu="૩" data-v="3">3</button><button class="btn" data-v="+">+</button>
        <button class="btn digit" data-en="00" data-gu="૦૦" data-v="00">00</button><button class="btn digit" data-en="0" data-gu="૦" data-v="0">0</button><button class="btn" data-v=".">.</button><button class="btn eq" data-v="=">=</button>
    </div>
</div>

<div id="garage" class="overlay" onclick="if(event.target==this) openGarage()">
    <div class="modal" onclick="event.stopPropagation()">
        <h2 style="text-align:center; margin-bottom:15px; color:#222; font-size:1.4rem;">V12 GARAGE</h2>
        <div class="row">Volume <input type="range" min="0" max="1" step="0.1" value="0.5" id="vol-ctrl" oninput="setCfg('vol', this.value)"></div>
        <div class="row">Soft Beep <select id="b-sel" onchange="setCfg('bProf', this.value)"></select></div>
        <div class="row">Piano <select id="p-sel" onchange="setCfg('pProf', this.value)"></select></div>
        <div class="row">Voice <button class="tog" onclick="tog('voice')" id="v-btn">ON</button></div>
        <div class="row">Lang <button class="tog" onclick="tog('guj')" id="l-btn">ENG</button></div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px; padding: 0 5px;">
            <span style="font-weight:900; font-size:12px; color:#666;">LOGS (10 MAX)</span>
            <button class="clr-btn" onclick="clearHist()">RESET</button>
        </div>
        <div id="hist"></div>
        <button class="close-btn" onclick="openGarage()">EXIT GARAGE</button>
    </div>
</div>

<script>
    let fullEq = "", ans = "0", isRes = false, audio;
    let cfg = {
        bProf: localStorage.getItem('v12_bp') || "b1",
        pProf: localStorage.getItem('v12_pp') || "p1",
        vol: parseFloat(localStorage.getItem('v12_v')) || 0.5,
        guj: localStorage.getItem('v12_g') === 'true',
        voice: localStorage.getItem('v12_s') !== 'false',
        theme: parseInt(localStorage.getItem('v12_t')) || 0
    };

    const gujN = ['૦','૧','૨','૩','૪','૫','૬','૭','૮','૯'];
    const pFreqs = {'AC':261.6,'DEL':293.6,'%':329.6,'/':349.2,'7':392.0,'8':440.0,'9':493.8,'*':523.2,'4':587.3,'5':659.2,'6':698.4,'-':783.9,'1':880.0,'2':987.7,'3':1046.5,'+':1174.6,'0':1318.5,'.':1396.9,'=':1567.9,'00':1000};
    
    const beeps = [
        {n:"Mute", f:0}, {n:"Soft Tap",f:800,t:'sine',d:0.08,g:0.3}, {n:"Silk Touch",f:1200,t:'sine',d:0.04,g:0.2}, 
        {n:"Digital Click",f:2000,t:'square',d:0.02,g:0.1}, {n:"Low Pulse",f:150,t:'triangle',d:0.12,g:0.4}, 
        {n:"Bubble Pop",f:600,t:'sine',d:0.15,g:0.4}, {n:"Feather",f:1800,t:'sine',d:0.06,g:0.2}, 
        {n:"Glass Ting",f:2800,t:'sine',d:0.08,g:0.3}, {n:"Sport Beep",f:1100,t:'sawtooth',d:0.04,g:0.1}, {n:"Eco Click",f:450,t:'sine',d:0.06,g:0.3}
    ];

    const pianos = [
        {n:"Mute Piano", f:0}, {n:"Grand Piano",t:'triangle',d:1.5,g:0.7}, {n:"Studio One",t:'sine',d:0.6,g:0.9},
        {n:"Mellow Gold",t:'sine',d:1.2,g:0.5}, {n:"Honky Tonk",t:'sawtooth',d:0.7,g:0.2},
        {n:"Electric Sky",t:'square',d:1.0,g:0.1}, {n:"Classic 88",t:'triangle',d:1.4,g:0.4},
        {n:"Toy Box",t:'sine',d:0.3,g:0.8}, {n:"Bright Key",t:'sine',d:0.5,g:1.0},
        {n:"Dark Night",t:'triangle',d:2.5,g:0.3}, {n:"Dream State",t:'sine',d:3.0,g:0.2},
        {n:"Space Echo",t:'sine',d:2.8,g:0.4}, {n:"Jazz Club",t:'sawtooth',d:0.9,g:0.1}
    ];

    function playHorn() {
        if(!audio) return;
        const now = audio.currentTime;
        [150, 155].forEach(f => {
            let o = audio.createOscillator(), g = audio.createGain();
            o.type = 'sawtooth'; o.frequency.setValueAtTime(f, now);
            g.gain.setValueAtTime(0.4 * cfg.vol, now);
            g.gain.exponentialRampToValueAtTime(0.001, now + 0.6);
            o.connect(g); g.connect(audio.destination); o.start(); o.stop(now + 0.6);
        });
    }

    function ignite() {
        audio = new (window.AudioContext || window.webkitAudioContext)();
        playHorn();
        document.getElementById('startup').style.display = 'none';
        document.getElementById('container').style.opacity = '1';
    }

    function playSfx(v) {
        if(!audio || cfg.vol === 0) return;
        const now = audio.currentTime;
        const b = beeps[parseInt(cfg.bProf.slice(1))];
        const p = pianos[parseInt(cfg.pProf.slice(1))];
        if(b && b.f > 0) {
            let o = audio.createOscillator(), g = audio.createGain();
            o.type = b.t; o.frequency.value = b.f; g.gain.setValueAtTime(cfg.vol * b.g, now);
            g.gain.exponentialRampToValueAtTime(0.001, now + b.d);
            o.connect(g); g.connect(audio.destination); o.start(); o.stop(now + b.d);
        }
        if(p && pFreqs[v] && cfg.pProf !== "p0") {
            let o = audio.createOscillator(), g = audio.createGain();
            o.type = p.t; o.frequency.value = pFreqs[v];
            g.gain.setValueAtTime(cfg.vol * p.g, now); g.gain.exponentialRampToValueAtTime(0.001, now + p.d);
            o.connect(g); g.connect(audio.destination); o.start(); o.stop(now + p.d);
        }
    }

    function handle(v) {
        playSfx(v);
        const eqDisp = document.getElementById('eq-display');
        if(v === 'AC') { fullEq = ""; ans = "0"; isRes = false; }
        else if(v === 'DEL') { if(isRes) { fullEq = ""; ans = "0"; isRes = false; } else fullEq = fullEq.slice(0, -1); }
        else if(v === '=') {
            try {
                let result = solve(fullEq);
                let record = fullEq + "=" + result;
                log(record);
                fullEq = record;
                ans = result;
                isRes = true;
                if(cfg.voice) speak(result);
            } catch { ans = "ERR"; }
        } else {
            if(isRes) { fullEq = (['+','-','*','/','%'].includes(v)) ? ans + v : v; isRes = false; }
            else { fullEq += v; }
            try { ans = solve(fullEq); } catch {}
        }
        render();
        setTimeout(() => { eqDisp.scrollLeft = eqDisp.scrollWidth; }, 10);
    }

    function solve(s) {
        if(!s) return "0";
        let c = s.toString().replace(/×/g,'*').replace(/÷/g,'/');
        const pRegex = /([0-9.]+)([+\-*/])([0-9.]+)%/g;
        while(pRegex.test(c)) {
            c = c.replace(pRegex, (m, n1, op, n2) => {
                let pVal = (n1 * n2) / 100;
                if(op === '*' || op === '/') pVal = n2 / 100;
                return `(${n1}${op}${pVal})`;
            });
        }
        c = c.replace(/([0-9.]+)%/g, "($1/100)");
        if(['+','-','*','/'].includes(c.slice(-1))) c = c.slice(0,-1);
        return Number(eval(c).toPrecision(12).split('e')[0]).toString().slice(0,12);
    }

    function render() {
        const tr = (s) => cfg.guj ? s.toString().replace(/[0-9]/g, i => gujN[i]) : s;
        document.getElementById('eq-display').innerText = tr(fullEq || "0");
        document.getElementById('ans-display').innerText = tr(ans);
        document.querySelectorAll('.digit').forEach(b => {
            b.innerText = cfg.guj ? b.dataset.gu : b.dataset.en;
        });
    }

    function nextTheme() { cfg.theme = (cfg.theme + 1) % 5; localStorage.setItem('v12_t', cfg.theme); applyTheme(); }
    function applyTheme() { document.body.className = `t-${cfg.theme}`; }
    
    function openGarage() { 
        const g = document.getElementById('garage');
        if(g.style.display==='flex') {
            g.style.display = 'none';
        } else {
            g.style.display = 'flex';
            showLog();
            playHorn();
        }
    }

    function setCfg(k, v) { cfg[k] = v; localStorage.setItem('v12_'+(k==='bProf'?'bp':k==='pProf'?'pp':k==='vol'?'v':'t'), v); updateMenu(); }
    function tog(k) { cfg[k] = !cfg[k]; localStorage.setItem('v12_'+(k==='guj'?'g':'s'), cfg[k]); updateMenu(); }

    function updateMenu() {
        document.getElementById('b-sel').innerHTML = beeps.map((b,i)=>`<option value="b${i}">${b.n}</option>`).join('');
        document.getElementById('p-sel').innerHTML = pianos.map((p,i)=>`<option value="p${i}">${p.n}</option>`).join('');
        document.getElementById('b-sel').value = cfg.bProf;
        document.getElementById('p-sel').value = cfg.pProf;
        document.getElementById('vol-ctrl').value = cfg.vol;
        document.getElementById('v-btn').innerText = cfg.voice ? "ON" : "OFF";
        document.getElementById('l-btn').innerText = cfg.guj ? "GUJ" : "ENG";
        render();
    }

    function speak(t) { window.speechSynthesis.cancel(); const u = new SpeechSynthesisUtterance(t); u.lang = cfg.guj ? 'gu-IN' : 'en-IN'; window.speechSynthesis.speak(u); }
    
    function log(txt) { 
        const tr = (s) => cfg.guj ? s.toString().replace(/[0-9]/g, i => gujN[i]) : s;
        let h = JSON.parse(localStorage.getItem('v12h')||"[]"); 
        h.unshift(tr(txt)); 
        if(h.length > 10) h = h.slice(0,10); 
        localStorage.setItem('v12h',JSON.stringify(h)); 
    }
    
    function showLog() { 
        document.getElementById('hist').innerHTML = JSON.parse(localStorage.getItem('v12h')||"[]")
            .map(x => `<div style="padding:10px; border-bottom:1px solid #eee; color:#333; font-size:14px; font-weight:bold;">${x}</div>`).join(''); 
    }
    
    function clearHist() { localStorage.removeItem('v12h'); showLog(); }

    document.getElementById('pad').addEventListener('touchstart', e => { if(e.target.dataset.v) { e.preventDefault(); handle(e.target.dataset.v); } });
    applyTheme(); updateMenu();
</script>
</body>
</html>
